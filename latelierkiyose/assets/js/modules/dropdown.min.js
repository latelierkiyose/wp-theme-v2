export default class Dropdown{constructor(){this.menuItems=document.querySelectorAll(".main-nav__list .menu-item-has-children"),this.init()}init(){this.menuItems.length&&this.menuItems.forEach(e=>{const t=e.querySelector("a"),o=e.querySelector(".sub-menu");t&&o&&(t.setAttribute("aria-haspopup","true"),t.setAttribute("aria-expanded","false"),t.addEventListener("click",e=>{window.innerWidth>=1024&&(e.preventDefault(),this.toggleDropdown(t,o))}),t.addEventListener("keydown",e=>{this.handleKeyDown(e,t,o)}),e.addEventListener("focusout",n=>{e.contains(n.relatedTarget)||this.closeDropdown(t,o)}),o.addEventListener("keydown",e=>{"Escape"===e.key&&(this.closeDropdown(t,o),t.focus())}))})}toggleDropdown(e,t){"true"===e.getAttribute("aria-expanded")?this.closeDropdown(e,t):this.openDropdown(e,t)}openDropdown(e,t){e.setAttribute("aria-expanded","true"),t.classList.add("is-open")}closeDropdown(e,t){e.setAttribute("aria-expanded","false"),t.classList.remove("is-open")}handleKeyDown(e,t,o){const n="true"===t.getAttribute("aria-expanded");switch(e.key){case"Enter":case" ":if(e.preventDefault(),this.toggleDropdown(t,o),!n){const e=o.querySelector("a");e&&e.focus()}break;case"Escape":n&&(e.preventDefault(),this.closeDropdown(t,o));break;case"ArrowDown":if(n){e.preventDefault();const t=o.querySelector("a");t&&t.focus()}else{e.preventDefault(),this.openDropdown(t,o);const n=o.querySelector("a");n&&n.focus()}break;case"ArrowUp":if(n){e.preventDefault();const t=o.querySelectorAll("a");t.length&&t[t.length-1].focus()}}}}