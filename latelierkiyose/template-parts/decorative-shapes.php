<?php
/**
 * Template part for rendering large organic SVG decorative shapes.
 *
 * Renders splashes, waves, blobs, and brushstrokes with a hand-drawn,
 * imperfect aesthetic. Each type has multiple variants chosen randomly
 * to avoid repetition.
 *
 * @package Kiyose
 * @since   0.2.0
 *
 * @param array $args {
 *     Optional. Shape parameters.
 *
 *     @type string $type     Shape type: 'splash', 'wave', 'blob', 'brushstroke', 'spiral'. Default 'splash'.
 *     @type string $color    CSS variable name for fill color. Default '--kiyose-color-primary'.
 *     @type float  $opacity  Fill opacity, 0 to 1. Default 0.4.
 *     @type string $size     Size preset: 'sm' (200px), 'md' (350px), 'lg' (500px). Default 'md'.
 *     @type string $position Position: 'top-left', 'top-right', 'bottom-left', 'bottom-right'. Default 'top-left'.
 *     @type int    $rotation Rotation in degrees. Default 0.
 * }
 */

$kiyose_type     = isset( $args['type'] ) ? $args['type'] : 'splash';
$kiyose_color    = isset( $args['color'] ) ? $args['color'] : '--kiyose-color-primary';
$kiyose_opacity  = isset( $args['opacity'] ) ? (float) $args['opacity'] : 0.4;
$kiyose_size     = isset( $args['size'] ) ? $args['size'] : 'md';
$kiyose_position = isset( $args['position'] ) ? $args['position'] : 'top-left';
$kiyose_rotation = isset( $args['rotation'] ) ? (int) $args['rotation'] : 0;
$kiyose_mode     = isset( $args['mode'] ) ? $args['mode'] : 'shape';
$kiyose_from_bg  = isset( $args['from_bg'] ) ? $args['from_bg'] : '#ffffff';

$kiyose_size_map = array(
	'sm' => 200,
	'md' => 350,
	'lg' => 500,
);

$kiyose_px = isset( $kiyose_size_map[ $kiyose_size ] ) ? $kiyose_size_map[ $kiyose_size ] : 350;

$kiyose_classes = array(
	'deco-shape',
	'deco-shape--' . $kiyose_position,
	'deco-shape--' . $kiyose_size,
);

if ( ! function_exists( 'kiyose_render_splash_1' ) ) {
	/**
	 * Render splash variant 1 — hand-traced potrace paint splatter (from splat.svg).
	 *
	 * @param string $color   CSS variable name for the fill color.
	 * @param float  $opacity Fill opacity.
	 */
	function kiyose_render_splash_1( $color, $opacity ) {
		?>
		<g transform="translate(0,1211) scale(0.1,-0.1)" fill="var(<?php echo esc_attr( $color ); ?>)" opacity="<?php echo esc_attr( $opacity ); ?>" stroke="none">
			<path d="M4265 12096 c-115 -37 -252 -142 -296 -227 -57 -112 -30 -207 142
-495 154 -259 214 -408 228 -562 14 -158 -6 -275 -99 -582 -59 -198 -74 -285
-66 -405 10 -140 32 -280 68 -420 41 -163 41 -249 2 -312 -16 -25 -46 -60 -67
-77 -36 -28 -45 -31 -110 -31 -62 0 -80 5 -134 34 -134 72 -293 237 -434 450
-135 204 -172 348 -279 1081 -94 646 -106 691 -216 846 -124 175 -299 256
-456 210 -70 -20 -155 -83 -210 -156 -46 -62 -114 -199 -135 -275 -21 -73 -31
-343 -22 -545 10 -205 30 -298 111 -501 143 -363 351 -599 690 -783 275 -149
565 -484 698 -806 77 -186 78 -302 4 -389 -61 -71 -245 -148 -324 -135 -67 11
-233 66 -329 108 -91 40 -169 83 -411 225 -163 95 -225 116 -345 116 -64 0
-113 -5 -135 -14 -131 -55 -190 -158 -170 -299 11 -82 43 -143 113 -219 81
-86 133 -109 267 -118 129 -7 581 -52 669 -66 193 -30 313 -194 236 -325 -56
-96 -232 -173 -733 -323 -416 -125 -592 -154 -1132 -191 -463 -32 -663 -59
-787 -105 -294 -111 -529 -331 -580 -544 -21 -90 -27 -332 -10 -426 43 -233
219 -500 385 -584 104 -52 175 -65 367 -65 158 0 176 2 251 27 44 15 109 45
145 68 144 93 219 174 476 519 291 390 446 537 587 556 211 29 306 -265 176
-545 -111 -237 -278 -360 -763 -562 -346 -144 -529 -252 -665 -393 -79 -81
-92 -112 -92 -219 0 -90 29 -173 92 -265 189 -272 398 -285 666 -39 175 162
463 517 657 812 120 182 221 257 346 256 101 0 171 -32 245 -113 51 -56 86
-114 119 -201 34 -93 33 -166 -10 -387 -44 -228 -45 -281 -6 -341 53 -82 123
-129 245 -164 110 -32 274 -6 339 53 22 20 68 109 87 167 67 211 224 305 335
201 27 -25 35 -41 35 -67 0 -38 -123 -497 -225 -841 -168 -566 -312 -952 -500
-1345 -121 -253 -241 -468 -624 -1121 -210 -359 -250 -463 -258 -682 -8 -193
23 -336 96 -452 22 -34 44 -53 88 -74 52 -26 68 -29 153 -29 116 1 194 20 315
80 163 80 275 191 359 355 92 180 126 332 221 1000 99 699 145 963 226 1312
201 874 490 1538 668 1538 74 0 194 -110 254 -234 48 -97 61 -169 61 -326 -1
-179 -25 -307 -114 -589 -93 -296 -111 -377 -117 -526 -4 -102 -2 -144 11
-195 47 -182 127 -268 278 -299 74 -16 328 -16 410 0 86 16 201 71 232 112 43
57 51 106 51 327 0 128 -5 231 -13 275 -18 93 -83 246 -187 434 -129 234 -130
238 -129 416 1 130 4 161 26 232 66 217 219 351 392 341 68 -4 69 -4 116 -55
85 -92 224 -395 335 -728 160 -479 246 -935 290 -1535 35 -483 59 -653 115
-822 71 -213 211 -427 312 -479 56 -29 130 -25 204 10 157 74 219 196 216 426
-2 183 -35 281 -257 745 -224 467 -266 569 -391 930 -170 492 -217 686 -218
915 -1 130 2 163 24 244 48 182 112 267 220 290 81 18 131 14 188 -15 83 -41
125 -112 197 -334 119 -363 239 -599 383 -752 73 -77 129 -108 194 -108 84 0
217 60 280 127 45 49 52 90 42 263 -5 85 -9 227 -9 315 0 147 2 164 24 208 53
108 202 177 387 177 164 0 326 -65 448 -180 214 -202 277 -407 346 -1125 11
-115 25 -232 31 -260 37 -165 196 -275 400 -275 90 0 182 25 281 77 173 90
220 184 198 398 -35 338 -142 549 -597 1183 -185 258 -222 318 -264 427 -57
146 -48 323 23 459 44 82 184 223 260 260 48 24 69 28 136 27 133 -1 326 -59
537 -161 279 -135 423 -267 534 -488 56 -111 93 -224 152 -466 95 -386 175
-583 332 -821 76 -115 240 -278 322 -321 100 -53 158 -67 246 -62 102 6 182
45 260 125 111 114 162 220 189 393 18 115 25 604 11 761 -14 153 -27 220 -77
374 -78 241 -181 415 -343 576 -159 160 -366 289 -546 341 -70 20 -102 23
-255 23 -156 0 -190 -3 -315 -30 -121 -25 -161 -29 -290 -29 -134 0 -160 3
-240 28 -149 45 -321 135 -404 212 -98 91 -146 185 -145 288 0 131 71 231 271
384 131 99 201 169 232 229 50 99 46 267 -9 380 -36 74 -101 135 -263 251
-133 95 -190 153 -224 230 -22 50 -25 68 -21 143 9 202 109 300 515 511 576
299 982 420 1463 435 205 7 368 -6 640 -48 230 -36 341 -41 387 -16 65 35 131
140 184 298 30 86 33 104 33 219 0 100 -5 136 -21 182 -63 180 -204 304 -398
352 -350 87 -902 12 -1276 -174 -235 -117 -714 -452 -1214 -850 -374 -298
-501 -365 -739 -389 -269 -27 -502 65 -585 231 -82 163 -3 327 209 437 70 37
164 71 370 136 173 55 344 168 455 302 64 77 138 222 154 301 19 91 13 181
-19 307 -48 191 -77 233 -187 276 -84 32 -171 30 -245 -5 -92 -44 -163 -103
-349 -293 -96 -98 -202 -202 -236 -230 -80 -66 -175 -113 -245 -120 -201 -21
-467 178 -524 389 -20 76 -17 223 6 337 28 140 86 313 221 668 159 417 164
436 163 598 0 112 -3 138 -24 190 -64 167 -184 271 -370 321 -89 24 -319 25
-408 1 -226 -61 -344 -205 -475 -583 -56 -161 -77 -259 -77 -359 0 -106 23
-195 96 -377 35 -86 73 -194 85 -239 19 -73 20 -89 9 -137 -41 -182 -292 -363
-505 -362 -78 1 -118 20 -230 110 -49 40 -108 81 -130 91 -52 23 -203 43 -276
36 -147 -13 -284 -129 -464 -392 -159 -232 -176 -246 -315 -253 -158 -8 -273
39 -318 130 -18 37 -26 75 -34 180 -24 312 -78 537 -174 723 -34 66 -89 173
-123 239 -57 111 -70 145 -94 241 -5 22 -12 294 -16 605 -7 625 -5 610 -71
642 -41 21 -98 22 -155 4z"/>
		</g>
		<?php
	}
}

if ( ! function_exists( 'kiyose_render_splash_2' ) ) {
	/**
	 * Render splash variant 2 — hand-traced potrace paint splatter with satellite droplets (from splat2.svg).
	 *
	 * @param string $color   CSS variable name for the fill color.
	 * @param float  $opacity Fill opacity.
	 */
	function kiyose_render_splash_2( $color, $opacity ) {
		?>
		<g transform="translate(0,1223) scale(0.1,-0.1)" fill="var(<?php echo esc_attr( $color ); ?>)" opacity="<?php echo esc_attr( $opacity ); ?>" stroke="none">
			<path d="M8217 12216 c-103 -38 -179 -124 -267 -301 -140 -280 -261 -765 -340
-1364 -32 -241 -38 -236 96 -65 667 853 946 1467 756 1667 -60 64 -169 92
-245 63z"/>
			<path d="M4298 11455 c-77 -21 -170 -70 -212 -110 -58 -57 -80 -115 -79 -205
1 -188 127 -417 538 -975 395 -537 543 -791 605 -1039 18 -72 21 -110 18 -195
-3 -98 -6 -112 -40 -183 -45 -94 -136 -189 -223 -232 -49 -24 -67 -28 -119
-24 -37 2 -81 13 -111 28 -78 38 -233 201 -390 410 -243 322 -366 430 -490
430 -121 0 -255 -121 -255 -232 0 -33 32 -113 66 -163 18 -27 97 -120 174
-205 216 -237 267 -325 258 -444 -5 -52 -12 -74 -42 -119 -64 -97 -139 -139
-245 -139 -112 0 -201 42 -475 225 -292 195 -404 225 -522 138 -55 -40 -106
-130 -112 -196 -3 -42 1 -65 21 -108 46 -102 137 -181 432 -377 274 -182 362
-261 416 -375 50 -104 37 -222 -32 -287 -61 -58 -143 -79 -304 -79 -222 1
-357 26 -1020 186 -259 62 -540 127 -625 144 -323 62 -522 64 -632 4 -65 -35
-90 -69 -96 -131 -4 -44 -1 -52 28 -86 99 -112 387 -177 1055 -235 602 -53
701 -63 860 -82 454 -55 702 -136 760 -250 44 -85 -23 -277 -134 -383 -107
-102 -261 -156 -503 -177 -200 -17 -449 0 -953 66 -523 68 -539 69 -795 70
-229 0 -251 -2 -329 -24 -201 -57 -289 -178 -279 -380 7 -129 48 -195 153
-242 41 -19 72 -24 180 -27 204 -6 398 32 979 194 584 162 821 212 1066 221
124 5 172 2 240 -11 164 -33 272 -109 329 -229 40 -85 54 -166 49 -289 -3 -83
-9 -112 -27 -148 -78 -150 -208 -232 -581 -370 -446 -165 -554 -253 -537 -438
5 -65 45 -152 79 -176 49 -34 133 -12 223 58 22 17 119 105 215 196 270 255
370 320 490 322 80 1 134 -27 215 -114 254 -268 229 -471 -78 -656 -79 -48
-150 -83 -465 -225 -317 -144 -422 -232 -422 -353 0 -95 110 -233 233 -294 60
-29 73 -32 139 -29 106 6 169 41 289 159 97 97 156 173 359 461 193 275 313
380 418 364 68 -10 145 -92 205 -216 179 -373 49 -745 -424 -1204 -125 -122
-265 -242 -649 -560 -304 -251 -462 -405 -548 -533 -68 -102 -92 -168 -92
-252 0 -117 91 -236 253 -328 220 -126 379 -115 521 38 139 151 207 313 451
1075 204 637 355 913 581 1065 108 72 191 95 329 94 132 -2 236 -29 391 -104
165 -80 219 -161 217 -330 -1 -102 -24 -203 -99 -437 -121 -380 -131 -489 -52
-579 44 -50 101 -76 179 -82 82 -6 129 9 181 56 74 67 119 183 178 467 68 320
113 452 180 528 116 132 319 125 420 -15 41 -56 67 -146 81 -279 20 -189 -2
-417 -106 -1089 -71 -462 -87 -631 -82 -859 3 -146 8 -212 22 -261 38 -139 97
-219 194 -264 67 -31 231 -29 316 4 194 74 265 219 252 514 -9 212 -55 422
-207 941 -199 680 -249 939 -220 1144 22 162 74 247 184 303 49 25 77 32 142
36 48 3 96 0 117 -7 93 -31 183 -125 253 -264 19 -37 68 -148 109 -248 41 -99
95 -220 121 -269 77 -150 178 -222 286 -206 64 10 139 48 175 89 93 106 67
213 -149 612 -84 156 -125 256 -138 338 -20 124 16 206 119 275 140 93 268
111 387 52 176 -86 301 -266 540 -771 63 -134 144 -302 179 -373 127 -252 253
-414 375 -481 48 -26 65 -30 136 -30 74 0 87 3 156 38 193 98 270 234 218 387
-60 178 -212 334 -705 725 -501 397 -691 591 -751 768 -70 203 60 400 290 440
154 26 344 -51 571 -234 44 -35 208 -190 365 -344 370 -363 495 -468 645 -542
89 -44 144 -56 232 -51 101 6 136 24 158 83 55 142 -59 300 -359 499 -61 40
-235 146 -386 236 -447 265 -632 398 -726 523 -55 74 -68 98 -83 161 -23 92
13 193 100 281 27 28 49 56 49 64 0 28 55 150 97 214 51 77 111 127 191 159
74 29 252 31 352 4 206 -55 445 -169 890 -425 297 -172 504 -275 630 -317 69
-23 103 -28 181 -29 89 0 99 2 144 30 53 33 95 97 116 176 16 58 7 90 -37 139
-102 113 -286 171 -998 316 -618 126 -832 185 -1019 281 -282 145 -311 339
-87 563 83 84 170 133 295 166 111 30 435 25 710 -10 456 -58 618 -43 728 67
94 94 116 252 70 516 -9 51 -23 99 -30 106 -7 8 -10 20 -7 29 9 24 -47 117
-89 147 -83 60 -202 59 -387 -3 -55 -18 -256 -113 -475 -224 -555 -280 -691
-329 -885 -322 -123 5 -173 23 -244 88 -86 79 -167 290 -152 393 9 62 59 141
118 188 69 54 200 116 393 184 318 111 416 158 490 230 60 58 79 105 73 179
-6 70 -56 176 -100 210 -81 61 -175 50 -402 -50 -202 -88 -314 -125 -406 -131
-120 -9 -213 25 -311 114 -84 76 -103 172 -51 254 71 111 196 189 707 443 464
231 607 318 721 438 39 41 84 101 99 132 62 127 26 264 -104 396 -73 73 -128
105 -215 121 -48 9 -69 7 -138 -10 -226 -58 -427 -240 -883 -806 -329 -407
-461 -542 -590 -601 -100 -46 -183 -18 -242 84 -25 42 -28 57 -28 137 0 147
51 261 277 623 236 378 295 519 270 641 -22 105 -117 181 -226 181 -77 0 -132
-26 -205 -99 -79 -78 -147 -179 -301 -446 -223 -387 -310 -499 -435 -562 -63
-32 -117 -37 -180 -18 -142 45 -201 169 -176 366 12 91 47 240 120 500 113
406 90 573 -87 639 -102 38 -197 19 -256 -51 -61 -72 -97 -177 -171 -494 -92
-395 -186 -517 -385 -503 -124 9 -208 75 -242 191 -19 65 -14 290 11 502 26
210 25 364 -2 425 -34 77 -97 114 -192 114 -119 -1 -183 -47 -206 -149 -17
-76 -2 -187 61 -435 62 -246 80 -345 80 -429 0 -173 -68 -238 -259 -248 -117
-7 -188 7 -279 52 -91 46 -161 110 -226 208 -134 203 -207 443 -306 1007 -114
656 -174 868 -287 1021 -88 119 -220 164 -365 124z"/>
			<path d="M10577 8019 c-57 -13 -90 -33 -131 -79 -49 -54 -67 -100 -67 -166 0
-123 99 -233 225 -250 134 -19 276 111 276 251 -1 152 -158 279 -303 244z"/>
			<path d="M160 7599 c-89 -40 -147 -119 -157 -214 -5 -42 -1 -63 19 -106 47
-103 129 -158 232 -159 74 0 131 26 181 82 49 53 68 101 68 169 1 173 -188
298 -343 228z"/>
			<path d="M11610 5724 c-313 -23 -820 -81 -820 -93 1 -17 526 -226 780 -311
387 -130 638 -184 860 -184 128 0 152 3 203 23 66 26 120 69 144 115 25 47 23
161 -4 211 -60 112 -202 180 -458 221 -98 15 -574 27 -705 18z"/>
			<path d="M1719 3780 c-959 -124 -1545 -320 -1659 -554 -25 -53 -26 -137 -1
-191 37 -82 142 -145 240 -145 277 1 780 260 1381 712 183 137 272 208 260
207 -3 -1 -102 -13 -221 -29z"/>
		</g>
		<?php
	}
}

if ( ! function_exists( 'kiyose_render_splash_3' ) ) {
	/**
	 * Render splash variant 3 — horizontally mirrored hand-traced potrace paint splatter (from splat2.svg).
	 *
	 * @param string $color   CSS variable name for the fill color.
	 * @param float  $opacity Fill opacity.
	 */
	function kiyose_render_splash_3( $color, $opacity ) {
		?>
		<g transform="translate(1280,1223) scale(-0.1,-0.1)" fill="var(<?php echo esc_attr( $color ); ?>)" opacity="<?php echo esc_attr( $opacity ); ?>" stroke="none">
			<path d="M8217 12216 c-103 -38 -179 -124 -267 -301 -140 -280 -261 -765 -340
-1364 -32 -241 -38 -236 96 -65 667 853 946 1467 756 1667 -60 64 -169 92
-245 63z"/>
			<path d="M4298 11455 c-77 -21 -170 -70 -212 -110 -58 -57 -80 -115 -79 -205
1 -188 127 -417 538 -975 395 -537 543 -791 605 -1039 18 -72 21 -110 18 -195
-3 -98 -6 -112 -40 -183 -45 -94 -136 -189 -223 -232 -49 -24 -67 -28 -119
-24 -37 2 -81 13 -111 28 -78 38 -233 201 -390 410 -243 322 -366 430 -490
430 -121 0 -255 -121 -255 -232 0 -33 32 -113 66 -163 18 -27 97 -120 174
-205 216 -237 267 -325 258 -444 -5 -52 -12 -74 -42 -119 -64 -97 -139 -139
-245 -139 -112 0 -201 42 -475 225 -292 195 -404 225 -522 138 -55 -40 -106
-130 -112 -196 -3 -42 1 -65 21 -108 46 -102 137 -181 432 -377 274 -182 362
-261 416 -375 50 -104 37 -222 -32 -287 -61 -58 -143 -79 -304 -79 -222 1
-357 26 -1020 186 -259 62 -540 127 -625 144 -323 62 -522 64 -632 4 -65 -35
-90 -69 -96 -131 -4 -44 -1 -52 28 -86 99 -112 387 -177 1055 -235 602 -53
701 -63 860 -82 454 -55 702 -136 760 -250 44 -85 -23 -277 -134 -383 -107
-102 -261 -156 -503 -177 -200 -17 -449 0 -953 66 -523 68 -539 69 -795 70
-229 0 -251 -2 -329 -24 -201 -57 -289 -178 -279 -380 7 -129 48 -195 153
-242 41 -19 72 -24 180 -27 204 -6 398 32 979 194 584 162 821 212 1066 221
124 5 172 2 240 -11 164 -33 272 -109 329 -229 40 -85 54 -166 49 -289 -3 -83
-9 -112 -27 -148 -78 -150 -208 -232 -581 -370 -446 -165 -554 -253 -537 -438
5 -65 45 -152 79 -176 49 -34 133 -12 223 58 22 17 119 105 215 196 270 255
370 320 490 322 80 1 134 -27 215 -114 254 -268 229 -471 -78 -656 -79 -48
-150 -83 -465 -225 -317 -144 -422 -232 -422 -353 0 -95 110 -233 233 -294 60
-29 73 -32 139 -29 106 6 169 41 289 159 97 97 156 173 359 461 193 275 313
380 418 364 68 -10 145 -92 205 -216 179 -373 49 -745 -424 -1204 -125 -122
-265 -242 -649 -560 -304 -251 -462 -405 -548 -533 -68 -102 -92 -168 -92
-252 0 -117 91 -236 253 -328 220 -126 379 -115 521 38 139 151 207 313 451
1075 204 637 355 913 581 1065 108 72 191 95 329 94 132 -2 236 -29 391 -104
165 -80 219 -161 217 -330 -1 -102 -24 -203 -99 -437 -121 -380 -131 -489 -52
-579 44 -50 101 -76 179 -82 82 -6 129 9 181 56 74 67 119 183 178 467 68 320
113 452 180 528 116 132 319 125 420 -15 41 -56 67 -146 81 -279 20 -189 -2
-417 -106 -1089 -71 -462 -87 -631 -82 -859 3 -146 8 -212 22 -261 38 -139 97
-219 194 -264 67 -31 231 -29 316 4 194 74 265 219 252 514 -9 212 -55 422
-207 941 -199 680 -249 939 -220 1144 22 162 74 247 184 303 49 25 77 32 142
36 48 3 96 0 117 -7 93 -31 183 -125 253 -264 19 -37 68 -148 109 -248 41 -99
95 -220 121 -269 77 -150 178 -222 286 -206 64 10 139 48 175 89 93 106 67
213 -149 612 -84 156 -125 256 -138 338 -20 124 16 206 119 275 140 93 268
111 387 52 176 -86 301 -266 540 -771 63 -134 144 -302 179 -373 127 -252 253
-414 375 -481 48 -26 65 -30 136 -30 74 0 87 3 156 38 193 98 270 234 218 387
-60 178 -212 334 -705 725 -501 397 -691 591 -751 768 -70 203 60 400 290 440
154 26 344 -51 571 -234 44 -35 208 -190 365 -344 370 -363 495 -468 645 -542
89 -44 144 -56 232 -51 101 6 136 24 158 83 55 142 -59 300 -359 499 -61 40
-235 146 -386 236 -447 265 -632 398 -726 523 -55 74 -68 98 -83 161 -23 92
13 193 100 281 27 28 49 56 49 64 0 28 55 150 97 214 51 77 111 127 191 159
74 29 252 31 352 4 206 -55 445 -169 890 -425 297 -172 504 -275 630 -317 69
-23 103 -28 181 -29 89 0 99 2 144 30 53 33 95 97 116 176 16 58 7 90 -37 139
-102 113 -286 171 -998 316 -618 126 -832 185 -1019 281 -282 145 -311 339
-87 563 83 84 170 133 295 166 111 30 435 25 710 -10 456 -58 618 -43 728 67
94 94 116 252 70 516 -9 51 -23 99 -30 106 -7 8 -10 20 -7 29 9 24 -47 117
-89 147 -83 60 -202 59 -387 -3 -55 -18 -256 -113 -475 -224 -555 -280 -691
-329 -885 -322 -123 5 -173 23 -244 88 -86 79 -167 290 -152 393 9 62 59 141
118 188 69 54 200 116 393 184 318 111 416 158 490 230 60 58 79 105 73 179
-6 70 -56 176 -100 210 -81 61 -175 50 -402 -50 -202 -88 -314 -125 -406 -131
-120 -9 -213 25 -311 114 -84 76 -103 172 -51 254 71 111 196 189 707 443 464
231 607 318 721 438 39 41 84 101 99 132 62 127 26 264 -104 396 -73 73 -128
105 -215 121 -48 9 -69 7 -138 -10 -226 -58 -427 -240 -883 -806 -329 -407
-461 -542 -590 -601 -100 -46 -183 -18 -242 84 -25 42 -28 57 -28 137 0 147
51 261 277 623 236 378 295 519 270 641 -22 105 -117 181 -226 181 -77 0 -132
-26 -205 -99 -79 -78 -147 -179 -301 -446 -223 -387 -310 -499 -435 -562 -63
-32 -117 -37 -180 -18 -142 45 -201 169 -176 366 12 91 47 240 120 500 113
406 90 573 -87 639 -102 38 -197 19 -256 -51 -61 -72 -97 -177 -171 -494 -92
-395 -186 -517 -385 -503 -124 9 -208 75 -242 191 -19 65 -14 290 11 502 26
210 25 364 -2 425 -34 77 -97 114 -192 114 -119 -1 -183 -47 -206 -149 -17
-76 -2 -187 61 -435 62 -246 80 -345 80 -429 0 -173 -68 -238 -259 -248 -117
-7 -188 7 -279 52 -91 46 -161 110 -226 208 -134 203 -207 443 -306 1007 -114
656 -174 868 -287 1021 -88 119 -220 164 -365 124z"/>
			<path d="M10577 8019 c-57 -13 -90 -33 -131 -79 -49 -54 -67 -100 -67 -166 0
-123 99 -233 225 -250 134 -19 276 111 276 251 -1 152 -158 279 -303 244z"/>
			<path d="M160 7599 c-89 -40 -147 -119 -157 -214 -5 -42 -1 -63 19 -106 47
-103 129 -158 232 -159 74 0 131 26 181 82 49 53 68 101 68 169 1 173 -188
298 -343 228z"/>
			<path d="M11610 5724 c-313 -23 -820 -81 -820 -93 1 -17 526 -226 780 -311
387 -130 638 -184 860 -184 128 0 152 3 203 23 66 26 120 69 144 115 25 47 23
161 -4 211 -60 112 -202 180 -458 221 -98 15 -574 27 -705 18z"/>
			<path d="M1719 3780 c-959 -124 -1545 -320 -1659 -554 -25 -53 -26 -137 -1
-191 37 -82 142 -145 240 -145 277 1 780 260 1381 712 183 137 272 208 260
207 -3 -1 -102 -13 -221 -29z"/>
		</g>
		<?php
	}
}

if ( ! function_exists( 'kiyose_render_wave_1' ) ) {
	/**
	 * Render a wave SVG variant.
	 *
	 * @param string $color   CSS variable name for the fill color.
	 * @param float  $opacity Fill opacity.
	 */
	function kiyose_render_wave_1( $color, $opacity ) {
		?>
		<path
			d="M0,220 C45,180 90,260 150,200 C210,140 240,230 310,190 C380,150 400,220 400,220 L400,400 L0,400 Z"
			fill="var(<?php echo esc_attr( $color ); ?>)"
			opacity="<?php echo esc_attr( $opacity ); ?>"
		/>
		<?php
	}
}

if ( ! function_exists( 'kiyose_render_wave_2' ) ) {
	/**
	 * Render wave variant 2 - more undulating, asymmetric.
	 *
	 * @param string $color   CSS variable name for the fill color.
	 * @param float  $opacity Fill opacity.
	 */
	function kiyose_render_wave_2( $color, $opacity ) {
		?>
		<path
			d="M0,250 C60,190 100,280 170,230 C240,180 270,270 340,210 C380,175 400,240 400,250 L400,400 L0,400 Z"
			fill="var(<?php echo esc_attr( $color ); ?>)"
			opacity="<?php echo esc_attr( $opacity ); ?>"
		/>
		<?php
	}
}

if ( ! function_exists( 'kiyose_render_blob_1' ) ) {
	/**
	 * Render a blob SVG variant.
	 *
	 * @param string $color   CSS variable name for the fill color.
	 * @param float  $opacity Fill opacity.
	 */
	function kiyose_render_blob_1( $color, $opacity ) {
		?>
		<path
			d="M180,60 C250,40 320,80 340,150 C360,220 330,290 270,320 C210,350 130,330 90,270 C50,210 70,120 120,80 C140,65 160,55 180,60 Z"
			fill="var(<?php echo esc_attr( $color ); ?>)"
			opacity="<?php echo esc_attr( $opacity ); ?>"
		/>
		<?php
	}
}

if ( ! function_exists( 'kiyose_render_blob_2' ) ) {
	/**
	 * Render blob variant 2 - more puddle-like, asymmetric.
	 *
	 * @param string $color   CSS variable name for the fill color.
	 * @param float  $opacity Fill opacity.
	 */
	function kiyose_render_blob_2( $color, $opacity ) {
		?>
		<path
			d="M160,70 C230,30 310,70 350,140 C375,185 360,250 310,300 C260,340 190,355 130,310 C70,265 40,190 65,130 C85,85 120,65 160,70 Z"
			fill="var(<?php echo esc_attr( $color ); ?>)"
			opacity="<?php echo esc_attr( $opacity ); ?>"
		/>
		<?php
	}
}

if ( ! function_exists( 'kiyose_render_brushstroke_1' ) ) {
	/**
	 * Render a brushstroke SVG variant.
	 *
	 * @param string $color   CSS variable name for the fill color.
	 * @param float  $opacity Fill opacity.
	 */
	function kiyose_render_brushstroke_1( $color, $opacity ) {
		?>
		<path
			d="M60,200 C80,185 120,175 180,180 C240,185 300,195 340,190 C355,188 360,195 355,205 C340,215 300,220 240,215 C180,210 120,215 80,210 C65,208 58,205 60,200 Z"
			fill="var(<?php echo esc_attr( $color ); ?>)"
			opacity="<?php echo esc_attr( $opacity ); ?>"
		/>
		<?php
	}
}

if ( ! function_exists( 'kiyose_render_brushstroke_2' ) ) {
	/**
	 * Render brushstroke variant 2 - shorter, more tapered.
	 *
	 * @param string $color   CSS variable name for the fill color.
	 * @param float  $opacity Fill opacity.
	 */
	function kiyose_render_brushstroke_2( $color, $opacity ) {
		?>
		<path
			d="M100,195 C130,180 180,178 230,185 C280,192 310,200 320,198 C330,196 328,205 315,210 C290,218 250,215 200,210 C150,205 120,210 105,208 C95,206 92,200 100,195 Z"
			fill="var(<?php echo esc_attr( $color ); ?>)"
			opacity="<?php echo esc_attr( $opacity ); ?>"
		/>
		<?php
	}
}

if ( ! function_exists( 'kiyose_render_wave_separator_1' ) ) {
	/**
	 * Render a full-width wave separator path — gentle triple wave.
	 *
	 * Designed for a 1440×120 viewBox. Fills below the wave line with the given color.
	 *
	 * @param string $fill_color CSS color value (hex, rgb, or var()) for the fill below the wave.
	 */
	function kiyose_render_wave_separator_1( $fill_color ) {
		?>
		<path
			d="M0,70 C180,30 360,100 540,65 C720,30 900,95 1080,60 C1260,25 1380,75 1440,65 L1440,120 L0,120 Z"
			style="fill: <?php echo esc_attr( $fill_color ); ?>;"
		/>
		<?php
	}
}

if ( ! function_exists( 'kiyose_render_wave_separator_2' ) ) {
	/**
	 * Render a full-width wave separator path — two bold organic humps.
	 *
	 * @param string $fill_color CSS color value for the fill below the wave.
	 */
	function kiyose_render_wave_separator_2( $fill_color ) {
		?>
		<path
			d="M0,90 C220,40 440,110 720,60 C1000,10 1240,85 1440,70 L1440,120 L0,120 Z"
			style="fill: <?php echo esc_attr( $fill_color ); ?>;"
		/>
		<?php
	}
}

if ( ! function_exists( 'kiyose_render_wave_separator_3' ) ) {
	/**
	 * Render a full-width wave separator path — four irregular peaks.
	 *
	 * @param string $fill_color CSS color value for the fill below the wave.
	 */
	function kiyose_render_wave_separator_3( $fill_color ) {
		?>
		<path
			d="M0,85 C120,50 250,100 440,70 C630,40 760,90 960,60 C1160,30 1300,80 1440,65 L1440,120 L0,120 Z"
			style="fill: <?php echo esc_attr( $fill_color ); ?>;"
		/>
		<?php
	}
}

if ( ! function_exists( 'kiyose_render_spiral_shape_1' ) ) {
	/**
	 * Render spiral shape variant 1 — potrace-traced single spiral.
	 *
	 * @param string $color   CSS variable name for the fill color.
	 * @param float  $opacity Fill opacity.
	 */
	function kiyose_render_spiral_shape_1( $color, $opacity ) {
		?>
		<g transform="translate(0,1280) scale(0.1,-0.1)" fill="var(<?php echo esc_attr( $color ); ?>)" opacity="<?php echo esc_attr( $opacity ); ?>" stroke="none">
			<path d="M5195 12794 c-601 -35 -1062 -119 -1545 -280 -514 -172 -977 -437
-1435 -823 -126 -106 -418 -394 -539 -531 -849 -962 -1431 -2220 -1616 -3489
-210 -1442 172 -3114 1054 -4609 805 -1367 1942 -2386 3156 -2829 278 -102
574 -171 900 -210 200 -24 663 -24 880 0 958 107 1943 467 3455 1262 452 239
1428 766 1485 804 80 52 207 178 272 268 384 533 326 1351 -112 1566 -131 65
-249 79 -415 52 -184 -30 -297 -78 -675 -287 -747 -413 -1160 -630 -1465 -769
-625 -283 -1068 -415 -1610 -480 -152 -18 -561 -16 -745 5 -947 105 -1910 446
-2649 938 -437 291 -800 633 -1068 1008 -518 724 -786 1865 -693 2953 92 1065
476 2009 1069 2630 679 710 1833 1157 2901 1124 824 -26 1456 -296 2054 -877
415 -404 707 -852 867 -1331 150 -447 159 -864 27 -1244 -41 -118 -159 -345
-247 -477 -438 -648 -1216 -1156 -1991 -1298 -148 -28 -433 -38 -579 -21 -254
30 -421 95 -548 215 -345 324 -440 879 -191 1112 73 68 142 96 254 102 166 9
316 -32 841 -227 262 -97 398 -132 543 -138 234 -11 323 34 599 302 308 299
441 538 441 796 0 313 -233 585 -734 858 -334 182 -1099 487 -1355 541 -313
66 -731 29 -1101 -98 -308 -106 -627 -279 -890 -482 -112 -87 -315 -283 -406
-392 -92 -110 -208 -287 -264 -403 -105 -216 -148 -395 -157 -651 -9 -269 22
-492 107 -769 178 -578 561 -1117 995 -1401 96 -63 235 -133 330 -167 39 -14
250 -72 470 -130 220 -59 461 -122 535 -142 527 -140 951 -235 1226 -274 742
-107 1348 -4 2454 418 385 147 561 249 763 440 205 196 364 412 518 706 502
958 651 2377 369 3520 -142 578 -380 1031 -767 1460 -758 840 -1960 1437
-3348 1664 -346 57 -649 81 -1040 85 -176 2 -347 2 -380 0z"/>
		</g>
		<?php
	}
}

if ( ! function_exists( 'kiyose_render_spiral_shape_2' ) ) {
	/**
	 * Render spiral shape variant 2 — potrace-traced scattered spiral fragments.
	 *
	 * @param string $color   CSS variable name for the fill color.
	 * @param float  $opacity Fill opacity.
	 */
	function kiyose_render_spiral_shape_2( $color, $opacity ) {
		?>
		<g transform="translate(0,1223) scale(0.1,-0.1)" fill="var(<?php echo esc_attr( $color ); ?>)" opacity="<?php echo esc_attr( $opacity ); ?>" stroke="none">
			<path d="M6927 12214 c-59 -19 -123 -80 -156 -148 -62 -133 -69 -371 -21 -736
5 -41 21 -181 35 -310 46 -424 64 -549 116 -820 60 -310 73 -344 155 -420 85
-78 184 -101 263 -60 59 29 122 107 152 186 54 140 59 208 59 788 0 557 -5
654 -50 909 -38 219 -123 392 -257 518 -102 97 -194 126 -296 93z"/>
			<path d="M10200 11637 c-128 -44 -241 -141 -320 -276 -65 -113 -186 -368 -303
-641 -58 -135 -138 -317 -177 -405 -101 -224 -136 -312 -165 -411 -27 -93 -32
-192 -14 -257 13 -47 63 -106 106 -123 38 -16 113 -18 164 -4 86 24 234 141
299 235 35 52 362 675 456 870 302 625 343 924 140 1016 -54 24 -107 23 -186
-4z"/>
			<path d="M3208 10784 c-121 -29 -225 -109 -247 -190 -37 -132 16 -303 157
-513 228 -340 547 -740 913 -1148 188 -208 294 -278 424 -278 85 0 122 23 160
99 47 93 28 260 -49 437 -62 144 -410 745 -569 984 -192 288 -395 540 -465
577 -88 48 -211 60 -324 32z"/>
			<path d="M8395 9384 c-779 -116 -1238 -211 -1607 -335 -303 -101 -415 -157
-772 -388 -317 -206 -438 -270 -826 -441 -255 -111 -574 -271 -690 -346 -385
-245 -765 -585 -1019 -909 -382 -487 -642 -985 -745 -1425 -43 -183 -51 -270
-51 -545 0 -261 6 -336 50 -695 25 -197 35 -322 56 -640 24 -389 84 -566 244
-725 226 -226 559 -361 1036 -422 255 -32 995 -19 1509 28 569 51 1164 226
1720 504 339 170 478 279 1085 850 646 608 717 685 1210 1320 475 611 694
1020 825 1545 96 383 95 673 -4 928 -144 375 -377 656 -618 746 -129 49 -380
70 -818 70 -357 0 -511 -10 -820 -55 -812 -117 -1692 -421 -2328 -806 -320
-193 -563 -380 -811 -626 -522 -515 -846 -1043 -941 -1532 -76 -394 -24 -866
135 -1228 217 -493 569 -741 1200 -846 377 -63 662 -44 1057 69 663 190 1280
595 1798 1180 348 392 534 713 606 1040 23 105 27 463 6 605 -42 285 -110 523
-172 602 -138 176 -650 174 -1451 -3 -459 -101 -875 -246 -1154 -400 -313
-174 -581 -454 -746 -783 -190 -378 -162 -688 83 -909 270 -244 764 -366 1168
-287 263 51 550 171 849 355 129 79 172 123 221 225 109 229 89 430 -51 509
-50 29 -61 31 -149 30 -80 0 -144 -12 -410 -72 -403 -92 -546 -115 -671 -110
-88 3 -100 6 -134 32 -99 76 -122 278 -48 433 48 103 170 211 308 274 98 44
718 247 830 271 81 18 132 22 270 22 150 -1 181 -4 267 -27 291 -77 529 -288
567 -502 8 -42 8 -85 1 -139 -12 -95 -63 -296 -96 -377 -71 -175 -232 -372
-549 -671 -314 -297 -528 -455 -790 -583 -380 -186 -771 -288 -1041 -271 -309
18 -688 203 -954 466 -183 181 -289 358 -342 570 -32 128 -30 342 5 506 60
284 214 629 381 852 319 428 952 848 1633 1085 360 125 695 202 1188 272 554
79 739 94 934 75 303 -28 527 -132 656 -304 230 -307 257 -720 80 -1203 -90
-243 -284 -599 -588 -1073 -190 -297 -433 -569 -881 -987 -561 -523 -775 -671
-1221 -846 -399 -157 -760 -250 -1150 -298 -149 -19 -535 -16 -678 4 -696 98
-1234 433 -1462 912 -119 251 -175 524 -175 860 0 432 105 744 456 1357 182
318 301 493 470 688 373 432 1054 899 1894 1300 502 239 672 298 1400 484 505
128 928 258 989 304 42 30 97 110 115 164 52 162 -31 262 -224 272 -47 2 -98
2 -115 0z"/>
			<path d="M1572 9039 c-69 -9 -156 -53 -186 -92 -53 -73 -58 -144 -18 -262 39
-115 93 -204 266 -435 260 -347 457 -572 725 -823 183 -172 219 -192 346 -192
74 0 98 4 132 22 142 76 151 290 21 507 -76 127 -305 465 -409 603 -214 285
-471 569 -557 616 -86 47 -220 70 -320 56z"/>
			<path d="M12220 8059 c-390 -41 -814 -129 -945 -197 -101 -53 -220 -173 -269
-274 -50 -101 -58 -182 -24 -248 13 -26 35 -51 53 -60 38 -18 135 -16 235 5
50 10 175 19 375 25 362 11 517 24 695 56 171 31 241 63 331 153 88 88 123
161 124 257 0 61 -4 77 -30 120 -38 61 -131 126 -222 154 -71 22 -169 24 -323
9z"/>
			<path d="M378 5870 c-127 -23 -240 -81 -312 -161 -133 -148 -57 -306 189 -390
91 -32 148 -40 540 -74 569 -51 777 -54 1082 -19 216 25 321 64 380 141 24 31
28 46 28 102 0 56 -6 76 -34 129 -48 88 -139 175 -228 218 -60 29 -91 37 -175
45 -133 13 -1408 21 -1470 9z"/>
			<path d="M10533 4965 c-186 -52 -284 -181 -284 -374 -1 -128 -8 -119 540 -643
363 -348 390 -367 541 -388 149 -21 286 17 363 99 65 69 82 123 82 256 0 100
-3 115 -27 165 -31 61 -261 311 -438 475 -188 174 -449 375 -521 401 -63 23
-192 27 -256 9z"/>
			<path d="M1765 3840 c-154 -40 -426 -150 -660 -267 -214 -107 -578 -304 -604
-327 -56 -50 -85 -185 -61 -287 30 -130 87 -202 185 -236 75 -26 228 -23 325
6 110 34 363 159 693 343 337 189 395 236 460 369 88 179 60 337 -70 403 -44
22 -178 20 -268 -4z"/>
			<path d="M8979 2954 c-55 -16 -120 -82 -152 -152 -17 -37 -22 -66 -22 -137 0
-90 0 -90 62 -215 156 -316 347 -586 574 -810 94 -93 164 -140 267 -177 190
-70 340 -41 400 77 45 90 24 219 -73 449 -139 331 -269 531 -453 701 -141 131
-341 246 -466 269 -73 13 -79 13 -137 -5z"/>
			<path d="M2913 2314 c-63 -31 -199 -170 -265 -271 -102 -154 -175 -328 -277
-657 -106 -338 -105 -335 -105 -476 0 -111 2 -130 23 -173 27 -56 59 -83 112
-97 75 -20 142 14 249 127 88 92 185 219 241 314 61 104 102 209 206 519 l96
285 1 105 c2 165 -45 274 -139 327 -52 29 -80 29 -142 -3z"/>
			<path d="M6710 1968 c-47 -32 -91 -108 -138 -241 -80 -226 -92 -336 -99 -877
-5 -437 -5 -447 17 -535 28 -111 59 -174 117 -236 110 -117 281 -98 427 49
127 127 136 185 136 892 0 419 -3 527 -15 578 -46 196 -209 371 -361 388 -41
5 -55 2 -84 -18z"/>
			<path d="M4646 1959 c-82 -19 -178 -81 -266 -169 -136 -137 -142 -152 -220
-615 -69 -415 -73 -527 -19 -682 67 -195 208 -286 347 -223 123 56 314 321
381 529 53 164 71 318 71 623 0 328 -18 426 -88 493 -54 51 -119 64 -206 44z"/>
		</g>
		<?php
	}
}

$kiyose_variants = array(
	'splash'      => array( 'kiyose_render_splash_1', 'kiyose_render_splash_2', 'kiyose_render_splash_3' ),
	'wave'        => array( 'kiyose_render_wave_1', 'kiyose_render_wave_2' ),
	'blob'        => array( 'kiyose_render_blob_1', 'kiyose_render_blob_2' ),
	'brushstroke' => array( 'kiyose_render_brushstroke_1', 'kiyose_render_brushstroke_2' ),
	'spiral'      => array( 'kiyose_render_spiral_shape_1', 'kiyose_render_spiral_shape_2' ),
);

// Wave separator mode — full-width organic separator between sections.
if ( 'separator' === $kiyose_mode ) {
	$kiyose_sep_variants = array(
		'kiyose_render_wave_separator_1',
		'kiyose_render_wave_separator_2',
		'kiyose_render_wave_separator_3',
	);
	$kiyose_sep_fn       = $kiyose_sep_variants[ array_rand( $kiyose_sep_variants ) ];

	// Accept CSS variable names (--name) or literal color values.
	$kiyose_fill = ( strpos( $kiyose_color, '--' ) === 0 ) ? 'var(' . $kiyose_color . ')' : $kiyose_color;
	$kiyose_bg   = ( strpos( $kiyose_from_bg, '--' ) === 0 ) ? 'var(' . $kiyose_from_bg . ')' : $kiyose_from_bg;
	?>
	<div
		class="wave-separator"
		role="presentation"
		aria-hidden="true"
		style="background-color: <?php echo esc_attr( $kiyose_bg ); ?>;"
	>
		<svg
			width="100%"
			viewBox="0 0 1440 120"
			preserveAspectRatio="none"
			aria-hidden="true"
			focusable="false"
		>
			<?php call_user_func( $kiyose_sep_fn, $kiyose_fill ); ?>
		</svg>
	</div>
	<?php
	return;
}

if ( ! isset( $kiyose_variants[ $kiyose_type ] ) ) {
	return;
}

$kiyose_type_variants = $kiyose_variants[ $kiyose_type ];
$kiyose_variant_fn    = $kiyose_type_variants[ array_rand( $kiyose_type_variants ) ];

$kiyose_viewbox_map = array(
	'splash'      => '0 0 1280 1225',
	'wave'        => '0 0 400 400',
	'blob'        => '0 0 400 400',
	'brushstroke' => '0 0 400 400',
	'spiral'      => '0 0 1280 1280',
);

$kiyose_par_map = array(
	'splash'      => 'xMidYMid meet',
	'wave'        => 'none',
	'blob'        => 'none',
	'brushstroke' => 'none',
	'spiral'      => 'xMidYMid meet',
);

$kiyose_viewbox = isset( $kiyose_viewbox_map[ $kiyose_type ] ) ? $kiyose_viewbox_map[ $kiyose_type ] : '0 0 400 400';
$kiyose_par     = isset( $kiyose_par_map[ $kiyose_type ] ) ? $kiyose_par_map[ $kiyose_type ] : 'none';
?>

<svg
	class="<?php echo esc_attr( implode( ' ', $kiyose_classes ) ); ?>"
	aria-hidden="true"
	role="presentation"
	width="<?php echo esc_attr( $kiyose_px ); ?>"
	height="<?php echo esc_attr( $kiyose_px ); ?>"
	viewBox="<?php echo esc_attr( $kiyose_viewbox ); ?>"
	style="--kiyose-deco-rotation: <?php echo esc_attr( $kiyose_rotation ); ?>deg"
	preserveAspectRatio="<?php echo esc_attr( $kiyose_par ); ?>"
>
	<?php call_user_func( $kiyose_variant_fn, $kiyose_color, $kiyose_opacity ); ?>
</svg>
